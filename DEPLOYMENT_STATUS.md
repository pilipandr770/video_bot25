# üöÄ –°—Ç–∞—Ç—É—Å –¥–µ–ø–ª–æ—è AI Video Generator Bot

## ‚úÖ –£—Å–ø–µ—à–Ω–æ –∑–∞–¥–µ–ø–ª–æ–µ–Ω–æ –Ω–∞ Render.com

**URL:** https://video-bot25.onrender.com  
**Telegram Bot:** @Video4min_bot  
**–î–∞—Ç–∞:** 13 –Ω–æ—è–±—Ä—è 2025

---

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Redis ‚Üí PostgreSQL
- **–ü—Ä–æ–±–ª–µ–º–∞:** Celery –∏ rate limiter –ø—ã—Ç–∞–ª–∏—Å—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Redis
- **–†–µ—à–µ–Ω–∏–µ:** –ú–∏–≥—Ä–∏—Ä–æ–≤–∞–ª–∏ –Ω–∞ PostgreSQL –¥–ª—è Celery, in-memory –¥–ª—è rate limiter

### 2. ‚úÖ Webhook URL
- **–ü—Ä–æ–±–ª–µ–º–∞:** –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ `/webhook` –≤ URL
- **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–µ–º URL –∫–∞–∫ –µ—Å—Ç—å –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è

### 3. ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- **–ü—Ä–æ–±–ª–µ–º–∞:** `initialize_app()` –≤—ã–∑—ã–≤–∞–ª–∞—Å—å —Ç–æ–ª—å–∫–æ –≤ `if __name__ == "__main__"`
- **–†–µ—à–µ–Ω–∏–µ:** –ü–µ—Ä–µ–Ω–µ—Å–ª–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –Ω–∞ —É—Ä–æ–≤–µ–Ω—å –º–æ–¥—É–ª—è –¥–ª—è gunicorn

### 4. ‚úÖ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π webhook handler
- **–ü—Ä–æ–±–ª–µ–º–∞:** Flask –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç `async def` view —Ñ—É–Ω–∫—Ü–∏–∏
- **–†–µ—à–µ–Ω–∏–µ:** –°–¥–µ–ª–∞–ª–∏ handler —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º —Å `asyncio.run()` –¥–ª—è async –∫–æ–¥–∞

### 5. ‚úÖ –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤–∏–¥–µ–æ
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±—ã–ª–∞ –Ω–∞ 4 –º–∏–Ω—É—Ç—ã (48 —Å–µ–≥–º–µ–Ω—Ç–æ–≤)
- **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ 50 —Å–µ–∫—É–Ω–¥ (10 —Å–µ–≥–º–µ–Ω—Ç–æ–≤) —Å–æ–≥–ª–∞—Å–Ω–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏

### 6. ‚úÖ –ü–æ–ª–µ animation_prompt
- **–ü—Ä–æ–±–ª–µ–º–∞:** –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–æ –ø–æ–ª–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤ –∞–Ω–∏–º–∞—Ü–∏–∏
- **–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `animation_prompt` –≤ —Ç–∞–±–ª–∏—Ü—É `VideoSegment`

---

## üìä –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –í–∏–¥–µ–æ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- **–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** 50 —Å–µ–∫—É–Ω–¥
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ–≥–º–µ–Ω—Ç–æ–≤:** 10
- **–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ–≥–º–µ–Ω—Ç–∞:** 5 —Å–µ–∫—É–Ω–¥
- **–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
  - Intro: —Å–µ–≥–º–µ–Ω—Ç—ã 0-2 (15 —Å–µ–∫—É–Ω–¥)
  - Main: —Å–µ–≥–º–µ–Ω—Ç—ã 3-6 (20 —Å–µ–∫—É–Ω–¥)
  - Outro: —Å–µ–≥–º–µ–Ω—Ç—ã 7-9 (15 —Å–µ–∫—É–Ω–¥)

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (PostgreSQL)
- **–¢–∞–±–ª–∏—Ü—ã:**
  - `video_jobs` - –æ—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è
  - `video_segments` - 10 —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –Ω–∞ –∑–∞–¥–∞–Ω–∏–µ
  - `approvals` - –æ–¥–æ–±—Ä–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### Rate Limiting
- **5 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É** –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **20 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —á–∞—Å** –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **Storage:** In-memory (–ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è single-instance)

---

## üéØ –ü–∞–π–ø–ª–∞–π–Ω –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤–∏–¥–µ–æ

### –≠—Ç–∞–ø 1: –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç –∏–ª–∏ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
- –°–æ–∑–¥–∞–µ—Ç—Å—è `VideoJob` –≤ –ë–î

### –≠—Ç–∞–ø 2: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ü–µ–Ω–∞—Ä–∏—è
- **Script Assistant** —Å–æ–∑–¥–∞–µ—Ç 50-—Å–µ–∫—É–Ω–¥–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ 3 —á–∞—Å—Ç–∏: intro, main, outro

### –≠—Ç–∞–ø 3: –û–¥–æ–±—Ä–µ–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏—è
- –û—Ç–ø—Ä–∞–≤–∫–∞ —Å—Ü–µ–Ω–∞—Ä–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- –û–∂–∏–¥–∞–Ω–∏–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫–∏

### –≠—Ç–∞–ø 4: –°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è
- **Segment Assistant** —Ä–∞–∑–±–∏–≤–∞–µ—Ç –Ω–∞ 10 —Å–µ–≥–º–µ–Ω—Ç–æ–≤
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

### –≠—Ç–∞–ø 5: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- 10 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —á–µ—Ä–µ–∑ Runway/DALL-E
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—É—Ç–µ–π –≤ –ë–î

### –≠—Ç–∞–ø 6: –û–¥–æ–±—Ä–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –û—Ç–ø—Ä–∞–≤–∫–∞ 10 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- –û–∂–∏–¥–∞–Ω–∏–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è

### –≠—Ç–∞–ø 7: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤ –∞–Ω–∏–º–∞—Ü–∏–∏
- **Animation Assistant** —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è –≤–∏–¥–µ–æ

### –≠—Ç–∞–ø 8: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ
- –ê–Ω–∏–º–∞—Ü–∏—è 10 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —á–µ—Ä–µ–∑ Runway
- –°–æ–∑–¥–∞–Ω–∏–µ 10 –≤–∏–¥–µ–æ –ø–æ 5 —Å–µ–∫—É–Ω–¥

### –≠—Ç–∞–ø 9: –û–¥–æ–±—Ä–µ–Ω–∏–µ –≤–∏–¥–µ–æ
- –û—Ç–ø—Ä–∞–≤–∫–∞ 10 –≤–∏–¥–µ–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- –û–∂–∏–¥–∞–Ω–∏–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è

### –≠—Ç–∞–ø 10: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–∑–≤—É—á–∫–∏
- TTS –¥–ª—è 3 —á–∞—Å—Ç–µ–π —Å—Ü–µ–Ω–∞—Ä–∏—è
- 3 –∞—É–¥–∏–æ —Ñ–∞–π–ª–∞

### –≠—Ç–∞–ø 11: –§–∏–Ω–∞–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞
- FFmpeg —Å–∫–ª–µ–∏–≤–∞–µ—Ç 10 –≤–∏–¥–µ–æ + 3 –∞—É–¥–∏–æ
- –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –≤–∏–¥–µ–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

---

## üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### VideoJob (1 –∑–∞–ø–∏—Å—å –Ω–∞ –∑–∞–¥–∞–Ω–∏–µ)
```sql
- id (UUID)
- user_id, chat_id
- prompt (–∏—Å—Ö–æ–¥–Ω—ã–π –∑–∞–ø—Ä–æ—Å)
- status (pending/processing/completed/failed)
- script, script_intro, script_main, script_outro
- audio_intro_path, audio_main_path, audio_outro_path
- final_video_path
- timestamps
```

### VideoSegment (10 –∑–∞–ø–∏—Å–µ–π –Ω–∞ –∑–∞–¥–∞–Ω–∏–µ)
```sql
- id, job_id, segment_index (0-9)
- section (intro/main/outro)
- text_prompt (—Ç–µ–∫—Å—Ç —Å–µ–≥–º–µ–Ω—Ç–∞)
- image_prompt (–ø—Ä–æ–º–ø—Ç –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)
- animation_prompt (–ø—Ä–æ–º–ø—Ç –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏) ‚ú® NEW
- image_path (–ø—É—Ç—å –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é)
- video_path (–ø—É—Ç—å –∫ –≤–∏–¥–µ–æ)
- image_status, video_status
- duration (5.0 —Å–µ–∫—É–Ω–¥)
- timestamps
```

### Approval (3 –∑–∞–ø–∏—Å–∏ –Ω–∞ –∑–∞–¥–∞–Ω–∏–µ)
```sql
- id, job_id
- approval_type (script/images/videos)
- status (pending/approved/rejected)
- timestamps
```

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å webhook
```bash
curl https://api.telegram.org/bot8370296832:AAETV_lHGioGKllkVraWZE2JUOKoFF0gZas/getWebhookInfo
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
{
  "ok": true,
  "result": {
    "url": "https://video-bot25.onrender.com/webhook",
    "has_custom_certificate": false,
    "pending_update_count": 0
  }
}
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å health endpoint
```bash
curl https://video-bot25.onrender.com/health
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
{
  "status": "healthy",
  "service": "ai-video-generator-bot"
}
```

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–æ—Ç–∞
1. –û—Ç–∫—Ä—ã—Ç—å Telegram
2. –ù–∞–π—Ç–∏ @Video4min_bot
3. –û—Ç–ø—Ä–∞–≤–∏—Ç—å `/start`
4. –û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç: –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

---

## üìù –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞ Render

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ
- `TELEGRAM_BOT_TOKEN` - —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –æ—Ç @BotFather
- `TELEGRAM_WEBHOOK_URL` - https://video-bot25.onrender.com/webhook
- `OPENAI_API_KEY` - –∫–ª—é—á OpenAI API
- `OPENAI_SCRIPT_ASSISTANT_ID` - ID Script Assistant
- `OPENAI_SEGMENT_ASSISTANT_ID` - ID Segment Assistant
- `OPENAI_ANIMATION_ASSISTANT_ID` - ID Animation Assistant
- `RUNWAY_API_KEY` - –∫–ª—é—á Runway API
- `DATABASE_URL` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç Render PostgreSQL

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ
- `LOG_LEVEL` - DEBUG/INFO/WARNING/ERROR (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: INFO)
- `MAX_CONCURRENT_JOBS` - –º–∞–∫—Å–∏–º—É–º –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 5)
- `FILE_CLEANUP_HOURS` - —á–∞—Å–æ–≤ –¥–æ —É–¥–∞–ª–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 1)

---

## üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **Rate limit –Ω–∞ –≤—Ç–æ—Ä–æ–π worker** - –±–µ–∑–æ–ø–∞—Å–Ω–æ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è, webhook —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø–µ—Ä–≤—ã–º worker'–æ–º
2. **In-memory rate limiting** - —Å—á–µ—Ç—á–∏–∫–∏ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –º–µ–∂–¥—É worker'–∞–º–∏ (–ø—Ä–∏–µ–º–ª–µ–º–æ –¥–ª—è —Ç–µ–∫—É—â–µ–π –Ω–∞–≥—Ä—É–∑–∫–∏)
3. **Single instance deployment** - –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è Redis –¥–ª—è rate limiting

---

## üìö –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É `/start`
2. ‚è≥ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –≤–∏–¥–µ–æ —Å —Ç–µ–∫—Å—Ç–æ–≤—ã–º –∑–∞–ø—Ä–æ—Å–æ–º
3. ‚è≥ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –≤–∏–¥–µ–æ —Å –≥–æ–ª–æ—Å–æ–≤—ã–º –∑–∞–ø—Ä–æ—Å–æ–º
4. ‚è≥ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –æ–¥–æ–±—Ä–µ–Ω–∏–π
5. ‚è≥ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—É—é —Å–±–æ—Ä–∫—É –≤–∏–¥–µ–æ

---

## üÜò Troubleshooting

### –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å webhook: `getWebhookInfo`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ Render
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å health endpoint
4. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

### –û—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç DATABASE_URL
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ API –∫–ª—é—á–∏ –≤–∞–ª–∏–¥–Ω—ã
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ Assistant ID —Å—É—â–µ—Å—Ç–≤—É—é—Ç –≤ OpenAI

### Rate limit errors
- –ù–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è –≤—Ç–æ—Ä–æ–≥–æ worker'–∞
- –ù–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–∞–±–æ—Ç—É –±–æ—Ç–∞
- Webhook —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø–µ—Ä–≤—ã–º worker'–æ–º

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 13 –Ω–æ—è–±—Ä—è 2025, 19:45 UTC
