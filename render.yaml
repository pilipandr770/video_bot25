services:
  # Flask Web Application
  - type: web
    name: ai-video-bot-web
    runtime: docker
    region: frankfurt
    plan: starter
    branch: main
    dockerfilePath: ./Dockerfile
    dockerContext: .
    envVars:
      - key: TELEGRAM_BOT_TOKEN
        sync: false
      - key: TELEGRAM_WEBHOOK_URL
        sync: false
      - key: OPENAI_API_KEY
        sync: false
      - key: OPENAI_SCRIPT_ASSISTANT_ID
        sync: false
      - key: OPENAI_SEGMENT_ASSISTANT_ID
        sync: false
      - key: OPENAI_ANIMATION_ASSISTANT_ID
        sync: false
      - key: RUNWAY_API_KEY
        sync: false
      - key: DATABASE_URL
        value: postgresql://ittoken_db_user:Xm98VVSZv7cMJkopkdWRkgvZzC7Aly42@dpg-d0visga4d50c73ekmu4g-a.frankfurt-postgres.render.com/ittoken_db
      - key: DATABASE_SCHEMA
        value: ai_video_bot
      - key: TEMP_DIR
        value: /app/temp
      - key: MAX_CONCURRENT_JOBS
        value: 5
      - key: FILE_CLEANUP_HOURS
        value: 1
      - key: FFMPEG_PATH
        value: ffmpeg
      - key: FFPROBE_PATH
        value: ffprobe
      - key: LOG_LEVEL
        value: INFO
    disk:
      name: web-temp-storage
      mountPath: /app/temp
      sizeGB: 10
    autoDeploy: true

  # Celery Worker
  - type: worker
    name: ai-video-bot-worker
    runtime: docker
    region: frankfurt
    plan: starter
    branch: main
    dockerfilePath: ./Dockerfile
    dockerContext: .
    dockerCommand: celery -A app.tasks worker --loglevel=info --concurrency=2
    envVars:
      - key: TELEGRAM_BOT_TOKEN
        sync: false
      - key: OPENAI_API_KEY
        sync: false
      - key: OPENAI_SCRIPT_ASSISTANT_ID
        sync: false
      - key: OPENAI_SEGMENT_ASSISTANT_ID
        sync: false
      - key: OPENAI_ANIMATION_ASSISTANT_ID
        sync: false
      - key: RUNWAY_API_KEY
        sync: false
      - key: DATABASE_URL
        value: postgresql://ittoken_db_user:Xm98VVSZv7cMJkopkdWRkgvZzC7Aly42@dpg-d0visga4d50c73ekmu4g-a.frankfurt-postgres.render.com/ittoken_db
      - key: DATABASE_SCHEMA
        value: ai_video_bot
      - key: TEMP_DIR
        value: /app/temp
      - key: MAX_CONCURRENT_JOBS
        value: 5
      - key: FILE_CLEANUP_HOURS
        value: 1
      - key: FFMPEG_PATH
        value: ffmpeg
      - key: FFPROBE_PATH
        value: ffprobe
      - key: LOG_LEVEL
        value: INFO
    disk:
      name: worker-temp-storage
      mountPath: /app/temp
      sizeGB: 20
    autoDeploy: true

# Note: Using existing PostgreSQL database dpg-d0visga4d50c73ekmu4g
# Database URL is configured in environment variables above
